(function(k,p,v){k.execute(function(){k.when("A","EDPAUIValidator").register("edpHandler",function(d,h){jQuery=d.$;return function(b,g){var a=[],q=v,m=h.safeReference(d.state("edp-params"),"edp-params",!0);if(m&&(q=h.safeReference(m.uniqueTokenIdentifier,"edp-params.uniqueTokenIdentifier",!0))){var e=function(c,f,e,b){var d=null;c=JSON.stringify(c);f=jQuery.ajax({url:g,type:"POST",contentType:"application/x-www-form-urlencoded; charset=utf-8",data:{encodedData:c,method:f,uniqueTokenIdentifier:q,ie:"UTF-8"},
dataType:"json",success:function(c){d=c;null!=e&&e(d)},error:function(c,f,e){b&&b(c,f,e)}});a.push(f)};return{fetchTopics:function(c,f,a){e({PageContext:{pageId:c},Filter:f,PaginationConfig:{}},"FetchTopics",function(c){a(c)},null)},fetchEventsInTopic:function(c,f,a,b){e({PageContext:{pageId:c},TopicKeyInfo:f,ThreadID:a},"FetchEventsInTopic",b,null)},deleteTopic:function(c,f,a,b){e({PageContext:{pageId:c},EntityInfo:aEntityInfo,TopicKeyInfo:f,ThreadID:a},"DeleteTopic",b,null)},updateTopic:function(c,
f,a,b){e({PageContext:{pageId:c},EntityInfo:aEntityInfo,TopicKeyInfo:f,TopicUpdateInfo:a},"UpdateTopic",b,null)},insertEvent:function(c,f,a,b,d){e({PageContext:{pageId:c},TopicKeyInfo:f,Event:a},"InsertEvent",b,d)},deleteEvent:function(c,f,a,b,d){e({PageContext:{pageId:c},TopicKeyInfo:f,Event:a,ThreadID:b},"DeleteEvent",d,function(){d(!1)})},abortPendingRequests:function(){for(var c=0;c<a.length;c++){var f=a[c];4!=f.readyState&&f.abort()}}}}}});k.when("A","a-modal","a-dropdown","a-popover-base-factory",
"EDPDropdown","EDPCommentBox","EDPAUIValidator").register("DefaultEDPView",function(d,h,b,g,a,q,m){var e=d.$;b=d.createClass({_modalName:"",_modalInstance:"",_clearExistingFeedback:!0,AUTO_SCROLL_DELAY:1E3,SCROLL_OFFSET:30,INGRESS_CONTAINER_SELECTOR:".edpIngressContainer",registerIngressModal:function(){var c=m.safeReference(d.state("edp-ingress-params"),"edp-ingress-params",!0);if(c){var f=e("#edpIngress"),a=m.safeReference(c.name,"modalParams.name",!0);a===v&&k.log("edp-ingress-params.name is undefined. modalParams = "+
JSON.stringify(c)+' A.state("edp-ingress-params") = '+JSON.stringify(d.state("edp-ingress-params")),"ERROR","EDP");var b=m.safeReference(c.width,"modalParams.width",!0),q=m.safeReference(c.header,"modalParams.header",!0),t=m.safeReference(c.dataStrategy,"modalParams.dataStrategy",!0),r=m.safeReference(c.defectPrompt,"modalParams.defectPrompt",!0),c=m.safeReference(c.featurePrompt,"modalParams.featurePrompt",!0),n;q&&a&&b&&t&&(this._modalName=a,a={name:this._modalName,dataStrategy:t,width:b,header:q},
n=g.create,g.create=function(c,a){if(a&&"attributes"in a&&"lightboxOptions"in a.attributes)return a.attributes.lightboxOptions.lockScroll=!1,n(c,a)},c&&r&&(this.featurePromptText=c,this.defectPromptText=r),this._modalInstance=h.create(f,a),g.create=n)}},renderFeedbackView:function(c){e("#a-popover-lgtbox").css("display","none");if(this._clearExistingFeedback){this._featureDropdown.hideError().show().api().removeOptions();this._defectDropdown.hideError().show().disable().api().removeOptions();this._edpComment.clearText().hideError();
c=c.featuresData;c.sort(function(c,a){c=parseInt(c.position);a=parseInt(a.position);return c<a?-1:c>a?1:0});for(var a=0;a<c.length;a++){var b=c[a];this._featureDropdown.api().addOption({text:b.text,value:b.value},b.position)}0<c.length&&this.featurePromptText&&this._featureDropdown.api().addOption({css_class:"edpDropdownDisabled",text:this.featurePromptText,value:"required_prompt"},0);this._clearExistingFeedback=!1}this._allPages.hide();this._edpFeedbackPage.show()},renderDefectsDropdown:function(c){this._featureDropdown.hideError();
this._edpComment.hideError();this._defectDropdown.show().enable();c=c.defectsData;this._defectDropdown.api().removeOptions();for(var a=0;a<c.length;a++){var b=c[a];this._defectDropdown.api().addOption(b,parseInt(a))}0<c.length&&this.defectPromptText&&this._defectDropdown.api().addOption({css_class:"edpDropdownDisabled",text:this.defectPromptText,value:"required_prompt"},0)},renderOverlay:function(c){var a=c.featureContainerId;c=c.customEventHandler;var b=e("#"+a);d.trigger(c,{action:"addOverlay",
featureContainerId:a});0<b.length&&!this.isElementInViewport(b)&&e("html, body").animate({scrollTop:b.offset().top-this.SCROLL_OFFSET},this.AUTO_SCROLL_DELAY)},removeOverlay:function(c){d.trigger(c.customEventHandler,{action:"removeOverlay",featureContainerId:c.featureContainerId})},displayFeatureSelectionError:function(){this._featureDropdown.showError()},renderThankYouPage:function(){this._allPages.hide();this._clearExistingFeedback=!0;this._edpThankYouPage.show()},hideEDPPage:function(){this._modalInstance.hide()},
hideDefectsDropdown:function(){this._defectDropdown.hide()},displayDefectSelectionError:function(){this._defectDropdown.showError()},disableDefects:function(){this._defectDropdown.api().removeOptions();this._defectDropdown.show().disable()},processViewAction:function(c,a){switch(c){case "RENDER_FEEDBACK_VIEW":this.renderFeedbackView(a);break;case "RENDER_DEFECTS":this.renderDefectsDropdown(a);break;case "DISPLAY_FEATURE_SELECTION_ERROR":this.displayFeatureSelectionError();break;case "DISPLAY_DEFECT_SELECTION_ERROR":this.displayDefectSelectionError();
break;case "RENDER_FEATURE_OVERLAY":this.renderOverlay(a);break;case "REMOVE_FEATURE_OVERLAY":this.removeOverlay(a);break;case "HIDE_DEFECTS":this.hideDefectsDropdown();break;case "DISPLAY_EMPTY_COMMENT_ERROR":this._featureDropdown.hideError().show();this._edpComment.showError();break;case "RENDER_SUBMISSION_ERROR_PAGE":case "RENDER_THANK_YOU_PAGE":this.renderThankYouPage();break;case "HIDE_EDP_WIDGET":this.hideEDPPage();break;case "DISABLE_DEFECTS":this.disableDefects()}},registerCallbacks:function(){var c=
this,a=function(){c._defectDropdown.close();c._featureDropdown.close()};d.on("a:popover:beforeShow:"+this._modalName,function(a){c._app.sendControlAction("EDP_WIDGET_OPEN",{})});d.on("a:popover:afterShow:"+this._modalName,function(b){e(c.INGRESS_CONTAINER_SELECTOR).parent().css("overflow-y","hidden");e(c.INGRESS_CONTAINER_SELECTOR).parentsUntil(".a-popover-modal",".a-popover-wrapper").css("border-color","#CDCDCD");e(document).scroll(a)});d.on("a:dropdown:selected:edpDefect",function(a){a=a.value;
c._defectDropdown.hideError();c._app.sendControlAction("DEFECT_CHANGED",{defect:a})});d.on("a:dropdown:selected:edpFeature",function(a){a=a.value;c._defectDropdown.hideError();c._app.sendControlAction("FEATURE_CHANGED",{feature:a})});d.on("a:popover:beforeHide:"+this._modalName,function(a){c._app.sendControlAction("EDP_WIDGET_CLOSE",{})});d.on("a:popover:afterHide:"+this._modalName,function(c){e(document).unbind("scroll",a)});e("[name='edpComment']").change(function(){c._edpComment.hideError()});
e("#edpSubmitButton").click(function(){var a=c._featureDropdown.api().val(),b=c._defectDropdown.api().val(),e=c._edpComment.api().val();c._app.sendControlAction("FEEDBACK_SUBMITTED",{feature:a,defect:b,comment:e})});e("#edpSuccessCloseButton").click(function(){c._app.sendControlAction("SUCCESS_PAGE_CLOSE")})},applyAccessibilityTweaks:function(){e("[name='edpFeature']").attr("tabindex",-1);e("[name='edpDefect']").attr("tabindex",-1)},initialize:function(c){this._app=c;this._ingressElement=e("#edpIngress");
this._allPages=e(".edpPage,.edpPageComponent");this._edpThankYouPage=e(".edpThankYouPage");this._edpFeedbackPage=e(".edpFeedbackPage");this._edpComment=new q("[name='edpComment']");this._featureDropdown=new a("[name='edpFeature']");this._defectDropdown=new a("[name='edpDefect']");this._defectSection=e(".edpDefectSection");this.registerIngressModal();this.registerCallbacks();this.applyAccessibilityTweaks();0<this._ingressElement.length&&(this._ingressElement[0].focus=function(){},this.isElementInViewport(this._ingressElement)&&
ue.count("edp_ingress_shown_in_viewport",1))}});b.prototype.isElementInViewport=function(a){a=a[0];a=a.getBoundingClientRect();return 0<=a.top&&0<=a.left&&a.bottom<=(p.innerHeight||document.documentElement.clientHeight)&&a.right<=(p.innerWidth||document.documentElement.clientWidth)};return b});k.when("A","EDPDataUtil","EDPModel").register("DefaultEDPController",function(d,h,b){var g={locks:{},acquire:function(a){var b=!1;a in this.locks||(b=this.locks[a]=!0);return b},release:function(a){a in this.locks&&
delete this.locks[a]},releaseAll:function(){this.locks={}}};return d.createClass({_app:"",_edpDataUtil:v,initialize:function(a){this._app=a;var g=this;this._model=new b;this._model.initialize_model();d.on("a:pageUpdate",function(){g._model.initialize_model()});this._edpDataUtil=new h},processControlAction:function(a,b){switch(a){case "EDP_WIDGET_OPEN":for(var d=[],e=this._model.getFeatureDefectInformation(),c=this._model.getFeatureList(),f=0;f<c.length;f++){var h=e[c[f]];d.push({text:h.displayName,
value:h.name,position:h.position})}this._app.sendViewAction("RENDER_FEEDBACK_VIEW",{featuresData:d});break;case "SUCCESS_PAGE_CLOSE":case "EDP_WIDGET_CLOSE":this._previousOverlayEventData&&this._app.sendViewAction("REMOVE_FEATURE_OVERLAY",this._previousOverlayEventData);g.releaseAll();this._app.sendViewAction("HIDE_EDP_WIDGET",b);break;case "FEATURE_CHANGED":this._previousOverlayEventData&&this._app.sendViewAction("REMOVE_FEATURE_OVERLAY",this._previousOverlayEventData);f=b.feature;"required_prompt"===
f&&this._app.sendViewAction("DISABLE_DEFECTS",this._previousOverlayEventData);e=this._model.getFeatureDefectInformation();this._previousOverlayEventData=d={featureContainerId:e[f].featureContainerId,customEventHandler:e[f].customEventHandler};this._app.sendViewAction("RENDER_FEATURE_OVERLAY",d);e=e[f].defects;d=[];for(f=0;f<e.length;f++)c=e[f],d.push({text:c.value,value:c.id});this._app.sendViewAction("RENDER_DEFECTS",{defectsData:d});2>d.length&&this._app.sendViewAction("HIDE_DEFECTS",b);break;case "FEEDBACK_SUBMITTED":var k=
this,f=b.feature,d=b.defect,c=b.comment,e=this._model.getFeatureDefectInformation();if(!f||"required_prompt"===f){this._app.sendViewAction("DISPLAY_FEATURE_SELECTION_ERROR",b);break}if(!d||"required_prompt"===d)if(1==e[f].defects.length)d=e[f].defects[0].id;else{this._app.sendViewAction("DISPLAY_DEFECT_SELECTION_ERROR",b);break}if(1==e[f].defects.length&&!c){this._app.sendViewAction("DISPLAY_EMPTY_COMMENT_ERROR",b);break}if(!g.acquire("FEEDBACK_SUBMITTED"))break;this._edpDataUtil.submitData(e[f],
d,c,function(a){g.release("FEEDBACK_SUBMITTED");a?k._app.sendViewAction("RENDER_THANK_YOU_PAGE",b):k._app.sendViewAction("RENDER_SUBMISSION_ERROR_PAGE",b)},function(a,c,e){g.release("FEEDBACK_SUBMITTED");b.errorData={xhr:a,textStatus:c,errorThrown:e};k._app.sendViewAction("RENDER_SUBMISSION_ERROR_PAGE",b)})}}})});k.when("A").register("LoggerEDPView",function(d){return d.createClass({EDP_FEATURE_NOT_SELECTED:"edp_feature_not_selected",EDP_DEFECT_NOT_SELECTED:"edp_defect_not_selected",EDP_COMMENT_NOT_ENTERED:"edp_defect_not_selected",
EDP_DEFECT_SUBMITTED_PREFIX:"edp_feature_submitted_",EDP_SUBMISSION_ERROR:"edp_submission_error",processViewAction:function(d,b){switch(d){case "DISPLAY_FEATURE_SELECTION_ERROR":ue.count(this.EDP_FEATURE_NOT_SELECTED,(ue.count(this.EDP_FEATURE_NOT_SELECTED)||0)+1);break;case "DISPLAY_EMPTY_COMMENT_ERROR":ue.count(this.EDP_COMMENT_NOT_ENTERED,(ue.count(this.EDP_COMMENT_NOT_ENTERED)||0)+1);break;case "DISPLAY_DEFECT_SELECTION_ERROR":ue.count(this.EDP_DEFECT_NOT_SELECTED,(ue.count(this.EDP_DEFECT_NOT_SELECTED)||
0)+1);break;case "RENDER_SUBMISSION_ERROR_PAGE":k.log("Editable Detail Page submission failed. Error: - "+JSON.stringify(b.errorData),"FATAL","EDPSubmissionFailure");ue.count(this.EDP_SUBMISSION_ERROR,(ue.count(this.EDP_SUBMISSION_ERROR)||0)+1);break;case "RENDER_THANK_YOU_PAGE":if(b&&"feature"in b){var g=this.EDP_DEFECT_SUBMITTED_PREFIX+b.feature;ue.count(g,(ue.count(g)||0)+1)}}},initialize:function(d){}})});k.when("A").register("LoggerEDPController",function(d){return d.createClass({EDP_INGRESS_CLICKED:"edp_ingress_clicked",
EDP_FEEDBACK_SUBMITTED:"edp_feedback_submitted",EDP_WIDGET_RENDERED:"edp_widget_rendered",processControlAction:function(d,b){switch(d){case "EDP_WIDGET_OPEN":ue.count(this.EDP_INGRESS_CLICKED,(ue.count(this.EDP_INGRESS_CLICKED)||0)+1);break;case "FEEDBACK_SUBMITTED":ue.count(this.EDP_FEEDBACK_SUBMITTED,(ue.count(this.EDP_FEEDBACK_SUBMITTED)||0)+1)}},initialize:function(d){ue.count(this.EDP_WIDGET_RENDERED,1)}})});k.when("A","edpHandler","EDPAUIValidator").register("EDPDataUtil",function(d,h,b){return d.createClass({init:function(){var g=
b.safeReference(d.state("edp-params"),"edp-params",!0);if(g&&(g=b.safeReference(g.edpEndPoint,"edp-params.edpEndPoint",!0))&&(g=b.safeReference(g.endPoint,"edp-params.edpEndPoint.endpoint",!0)))return this.edpHandler=h("detail",g),this},submitData:function(g,a,h,k,e){var c,f,w,p,u,t,r={},n,l;if(c=b.safeReference(g,"featureMetaData",!0))if(a=b.safeReference(a,"defectId/discriminator",!0))if(f=b.safeReference(c.asin,"featureMetaData.asin",!0),w=b.safeReference(c.name,"featureMetaData.name",!0),p=b.safeReference(c.metadata,
"featureMetaData.metadata",!0),u=b.safeReference(c.resolver,"featureMetaData.resolver",!0),f&&w&&u){c={dataHash:c.dataHash,discriminator:a,topicName:w};a={defect_id:a};d.objectIsEmpty(g.editDataState)||b.safeReference(d.state(g.editDataState),"featureAdditionalEditData",!0)&&(r=d.state(g.editDataState));if(r)for(t in r)r.hasOwnProperty(t)&&(a[t]=r[t]);if(g=b.safeReference(d.state("edp-item-param"),"edp-item-param",!0))l=b.safeReference(g.productID,"edpItemState.productID",!0),n=b.safeReference(g.nodeID,
"edpItemState.nodeID",!0);h={glProductGroup:l,browseNodeId:n,metaData:p,editData:a,supplementaryInfo:{comment:h}};u={eventData:JSON.stringify(h),eventType:"upvote",eventSink:u};this.edpHandler.insertEvent(f,c,u,k,e)}}})});k.when("A").register("EDPFeatureEvents",function(d){var h=d.$;d.on("imageBlockEDPCustomEventHandler",function(a){var b=h("#imageBlockEDPOverlay"),d=h("#altImages"),e=h("#mainImageContainer");switch(a.action){case "addOverlay":b.addClass("edpImageBlockOverlayStyle");h("#altImages").css("position");
h("#altImages").css("z-index");e.length&&e.css("position");d.css("position","relative");d.css("z-index","1000000");e.css("position","relative");break;case "removeOverlay":b.removeClass("edpImageBlockOverlayStyle"),d.css("position",""),d.css("z-index",""),e.css("position","")}});d.on("productTitleEDPCustomEventHandler",function(a){var b=h("#"+a.featureContainerId);switch(a.action){case "addOverlay":b.addClass("edpTitleOverlayStyle");break;case "removeOverlay":b.removeClass("edpTitleOverlayStyle")}});
var b=function(a){if(a)return a=a.split("/").reverse().join(""),a.substring(0,a.indexOf("."))},g=function(){if("undefined"!==typeof DetailPage&&"StateController"in DetailPage){var a=DetailPage.StateController.getState().current_asin;a&&h("[data-edp-feature-name='imageBlock']").attr("data-edp-asin",a)}};d.on("dp:image-block:update",function(a){var h=a.variant;d.state("imageBlockEDPEditData",{imageId:b(a.hiRes?a.hiRes:a.large),image_type:h});g()});d.on("a:pageUpdate",function(){g()});d.state("productTitleEDPEditData",
{flag:"item_name"});d.state("featureBulletsEDPEditData",{flag:"bullet_point"})});k.when("A","DefaultEDPView","LoggerEDPView","DefaultEDPController","LoggerEDPController","EDPAUIValidator").register("EDPWidget",function(d,h,b,g,a,q){var m=d.$;return new (d.createClass({_views:[new h,new b],_controllers:[new g,new a],_isDebug:!1,init:function(){if(m("#edpIngress")){var a=q.safeReference(d.state("edp-params"),"edp-params",!1);if(a&&q.safeReference(d.state("edp-ingress-params"),"edp-params",!1)){a.hasOwnProperty("edpDebug")&&
(this._isDebug=a.edpDebug);for(a=0;a<this._views.length;a++)this._views[a].initialize(this);for(a=0;a<this._controllers.length;a++)this._controllers[a].initialize(this)}else k.log("Aborting EDP registration as required EDP metadata not found on page.","WARN","EDP")}else k.log("Aborting EDP registration as EDP ingress not found on page.","WARN","EDP")},sendViewAction:function(a,c){for(var b=0;b<this._views.length;b++){var d=this._views[b];this._isDebug&&(console.log("Executing view for event "+a+" with data"),
console.dir(c));d.processViewAction(a,c)}},sendControlAction:function(a,c){for(var b=0;b<this._controllers.length;b++){var d=this._controllers[b];this._isDebug&&(console.log("Executing Control/Store for event "+a+" with data"),console.dir(c));d.processControlAction(a,c)}}}))});k.when("A","a-dropdown").register("EDPDropdown",function(d,h){function b(a){this.selector=a}var g=d.$;b.prototype.api=function(){return h.getSelect(this.selector)};b.prototype.showError=function(){g(this.selector).parent().find(".a-button-dropdown").addClass("edpDropdownError");
return this};b.prototype.hideError=function(){g(this.selector).parent().find(".a-button-dropdown").removeClass("edpDropdownError");return this};b.prototype.hide=function(){g(this.selector).parent().hide();return this};b.prototype.show=function(){g(this.selector).parent().show();return this};b.prototype.disable=function(){this.api().update({status:"disabled"});return this};b.prototype.enable=function(){this.api().update({status:"enabled"});return this};b.prototype.focus=function(){g(this.selector).parent().find(".a-button-text").focusin();
return this};b.prototype.close=function(){this.api().update({});return this};return b});k.when("A").register("EDPCommentBox",function(d){function h(b){this.selector=b}var b=d.$;h.prototype.api=function(){return b(this.selector)};h.prototype.showError=function(){b(this.selector).addClass("edpDropdownError");return this};h.prototype.hideError=function(){b(this.selector).removeClass("edpDropdownError");return this};h.prototype.hide=function(){b(this.selector).hide();return this};h.prototype.show=function(){b(this.selector).show();
return this};h.prototype.clearText=function(){b(this.selector).val("");return this};return h});k.when("A").register("EDPModel",function(d){return d.createClass({_model:{},initialize_model:function(){var d=this._model.featureDefectInformation={},b=0,g=this._model.featuresList=[];jQuery(".edp-feature-declaration").each(function(){var a=jQuery(this),k=jQuery.trim(a.attr("data-edp-asin")),m=a.data("customEventHandler"),e=jQuery.trim(a.attr("data-edp-feature-name")),c=a.data("data-hash"),f=a.data("defects"),
p=a.data("placeholder-id"),x=a.data("metadata"),u=a.data("resolver"),t=a.data("displayName"),r=a.data("editDataState"),n=a.data("position"),a=a.data("featureContainerId"),l={};l.name=e;l.asin=k;l.displayName=t;l.editDataState=r;l.dataHash=c;l.defects=f;l.placeHolderId=p;l.metadata=x;l.resolver=u;l.position=n==v||null==n||""===n?b:parseInt(n);l.customEventHandler=m;l.featureContainerId=a;g.push(e);d[e]=l;b++})},getFeatureDefectInformation:function(){return this._model.featureDefectInformation},getFeatureList:function(){return this._model.featuresList}})});
k.when("A","ready").register("EDPAUIValidator",function(d){return{safeReference:function(d,b,g){return"undefined"!==typeof d&&d?d:(k.log("Parameter is empty or undefined : "+b,g?"FATAL":"WARN","EDP"),v)}}})})})(function(){var k=window.AmazonUIPageJS||window.P,p=k._namespace||k.attributeErrors;return p?p("EDPAsset"):k}(),window);